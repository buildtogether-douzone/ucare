<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="receipt">	
	<insert id="create" parameterType="patientvo">
		INSERT
			INTO ucare.patient(name, ssn, age, gender, tel_no, address, email, insurance_yn, diagnosis_type, visit_date, remark, ins_dt, user_no)
		VALUES(
			#{name },
			#{ssn },
			#{age },
			#{gender },
			#{telNo },
			#{address },
			#{email },
			#{insurance },
			#{diagnosis },
			TO_DATE(#{visitDate },'YYYY-MM-DD'),
			#{remark },
			TO_DATE(#{visitDate },'YYYY-MM-DD'),
			(SELECT user_no FROM ucare.user WHERE id = #{userId } )
		)
	</insert>
	
	<select id="retrieveAll" resultType="receiptvo" >
			SELECT
				A.receipt_no AS receiptNo,
				B.name AS name,
				B.gender AS gender,
				B.age AS age,
				B.address as address,
				B.insurance_yn AS insurance,
				B.diagnosis_type AS diagnosis,
				B.patient_no AS patientNo,
				A.receipt_dt AS receiptDt,
				A.remark AS remark
			FROM
				ucare.receipt A
			INNER JOIN ucare.patient B ON
				A.patient_no = B.patient_no;
	</select>
	
	<select id="findUser" parameterType="patientvo" resultType="patientvo">
		SELECT id,
			   name
		FROM ucare.user
		WHERE id = #{id }
		  AND password = #{password }
	</select>
	
	<select id="findByID" parameterType="patientvo" resultType="patientvo">
		SELECT name,
			   password,
			   tel_no AS telNo,
			   split_part(email, '@', 1) as emailId,
			   split_part(email, '@', 2) as email,
			   address,
			   birth
		FROM ucare.user
		WHERE id = #{id }
	</select>
	
	<update id="updateUser" parameterType="uservo">
			UPDATE  ucare.user
			   SET 
			   		name = #{name },
			   		<if test="password != null and password != '' ">
			   		password = #{password },
			   		</if>
			   		tel_no = #{telNo },
			   		email = #{email },
			   		address = #{address },
			   		birth = TO_DATE(#{birth },'YYYY-MM-DD'),
			   		image = #{image }
			WHERE id = #{id }
	</update>
	
	<update id="update" parameterType="diseasevo">
			UPDATE  ucare.disease
			   SET 
			   		disease_nm = #{diseaseNm },
			   		symptom = #{symptom }
			WHERE disease_no = #{diseaseNo }
	</update>
	
	<delete id="delete" parameterType="int">
		DELETE
		  FROM ucare.disease
		 WHERE disease_no = #{diseaseNo }
	</delete>

</mapper>
